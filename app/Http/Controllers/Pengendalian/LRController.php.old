<?php

namespace App\Http\Controllers\Pengendalian;

use App\Http\Controllers\Controller;

use App\Http\Services\LabaRugiService;

use Illuminate\Http\Request;
use App\Entities\StrategiBisnis;
use App\Entities\Fase;
use App\Entities\Distrik;
use App\Entities\FileImport;
use App\Entities\Lokasi;
use App\Entities\User;
use App\Entities\Role;
use App\Entities\PgdlReportDashboardSetting;
use App\Entities\PgdlLRParentCode;
use App\Entities\PBCAO;
use App\Entities\PgdlPljPrkAo;
use App\Entities\PGDLFileImportRevisi;
use App\Entities\PgdlRealisasiProduksiPenjualan;
use DB;
use Input;
use Excel;
use PDF;

class LRController extends Controller
{

    public function index(Request $request)
    {
        $user_id = session('user_id');
        $user = User::find($user_id);
        $role_id = session('role_id');
        $role = Role::find($role_id);

        $input_tahun = $request->input('tahun_anggaran');

        $input_sb = $request->input('strategi_bisnis');
        $strategi_bisnis = StrategiBisnis::where('name', $input_sb)->first();
        $int_input_sb = $strategi_bisnis->id;

        $input_distrik = $request->input('distrik');
        $distrik = Distrik::where('name', $input_distrik)->first();
        $int_input_distrik = $distrik->id;

        $input_fase = $request->input('fase');
        $fase = Fase::where('name', $input_fase)->first();
        $int_input_fase = $fase->id;

        $input_bulan = $request->input('bulan');

        $lokasi = Lokasi::where('distrik_id', $distrik->id)->get();
        $input_lokasi = $request->input('lokasi');

        if (!$input_tahun) {
            return redirect()->action('PencarianReportDashboardPengendalianController@pencarian');
        }
        if ($int_input_sb < 1 || $int_input_sb > 2) {
            return redirect()->action('PencarianReportDashboardPengendalianController@pencarian');
        }
        $distrik_id = Distrik::pluck('id')->toArray();
        if (!in_array($int_input_distrik, $distrik_id)) {
            return redirect()->action('PencarianReportDashboardPengendalianController@pencarian');
        }
        $fase_id = Fase::pluck('id')->toArray();
        if (!in_array($int_input_fase, $fase_id)) {
            return redirect()->action('PencarianReportDashboardPengendalianController@pencarian');
        }

        $nama_bln[0] = '';
        $nama_bln[1] = 'Januari';
        $nama_bln[2] = 'Februari';
        $nama_bln[3] = 'Maret';
        $nama_bln[4] = 'April';
        $nama_bln[5] = 'Mei';
        $nama_bln[6] = 'Juni';
        $nama_bln[7] = 'Juli';
        $nama_bln[8] = 'Agustus';
        $nama_bln[9] = 'September';
        $nama_bln[10] = 'Oktober';
        $nama_bln[11] = 'November';
        $nama_bln[12] = 'Desember';

        foreach ($nama_bln as $key => $value) {
            if ($value == $input_bulan) {
                $int_input_bulan = $input_bulan = $key;
                break;
            }
        }

        if ($int_input_bulan >= 1 && $int_input_bulan <= 12) {
            $nama_bln_dipilih = $nama_bln[$int_input_bulan];
        } else {
            return redirect()->action('PencarianReportDashboardPengendalianController@pencarian');
        }

        if ($distrik->name != 'UBJOM LUAR JAWA -1' && $distrik->name != 'UBJOM LUAR JAWA -2') {
            if (!$input_lokasi) {
                $input_lokasi = Lokasi::where('distrik_id', $distrik->id)->first();
            } else {
                $input_lokasi = Lokasi::where('distrik_id', $distrik->id)->where('name', $input_lokasi)->first();
            }
        }

        $source = array();

        $jenis_form_yg_digunakan = PgdlReportDashboardSetting::where('pgdl_report_dashboard_page_id', 6)
            ->whereNotNull('jenis_id')
            ->where('tahun', $input_tahun)
            ->select('jenis_id')
            ->distinct()
            ->get();

        $notification_failed = '';
        if (count($jenis_form_yg_digunakan) == 0) {
            $notification_failed = 'Setting Report Dashboard Laba Rugi untuk tahun ' . $input_tahun . ' belum dibuat!';
            return view('pengendalian_output.lr.index', compact('input_tahun', 'distrik', 'lokasi', 'nama_bln_dipilih', 'notification_failed', 'input_lokasi'));
        } else {
            $jenis_form = $jenis_form_yg_digunakan[0];

            if ($distrik->name == 'UBJOM LUAR JAWA -1' || $distrik->name == 'UBJOM LUAR JAWA -2') {
                $file_imports_pgdl = $this->get_file_id_pengendalian($jenis_form->jenis_id, $input_tahun, $int_input_distrik);
            } else {
                $file_imports_pgdl = $this->get_file_id_pengendalian_non_luar_jawa($jenis_form->jenis_id, $input_tahun, $int_input_distrik, $input_lokasi->id);
            }

            $settings = PgdlReportDashboardSetting::where('pgdl_report_dashboard_page_id', 6)
                ->where('jenis_id', $jenis_form->jenis_id)
                ->where('tahun', $input_tahun)
                ->orderBy('sequence')
                ->get();

            $lr_result = array();
            $result_data = array();
            if ($file_imports_pgdl != null) {
                $result_data = array();
                foreach ($settings as $column_setting) {
                    $jenis_id = $column_setting->jenis_id;
                    $column_result = array();
                    $column_result_ketetapan = array();
                    // jika dari pengendalian, cari berdasarkan kolom
                    if ($column_setting->pgdl_report_dashboard_source_id == 2) {
                        if ($distrik->name == 'UBJOM LUAR JAWA -1' || $distrik->name == 'UBJOM LUAR JAWA -2') {
                            $column_result = $this->get_data_pengendalian($file_imports_pgdl, $column_setting->pgdl_sheet_name, $column_setting->kolom);
                        } else {
                            $column_result = $this->get_data_pengendalian_non_luar_jawa($file_imports_pgdl, $column_setting->pgdl_sheet_name, $column_setting->kolom, $input_lokasi->id);
                        }
                    } elseif ($column_setting->pgdl_report_dashboard_source_id == 1) {
                        // if ($distrik->name == 'UBJOM LUAR JAWA -1' || $distrik->name == 'UBJOM LUAR JAWA -2') {
                        //        $column_result_ketetapan = $this->get_data_ketetapan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR' ,$column_setting->kolom, 13);
                        // } else {
                        $column_result_ketetapan = $this->get_data_ketetapan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', $column_setting->kolom, 13, $input_lokasi->id);
                        // }
                    }
                    $result_data[$column_setting->judul_kolom] = $column_result;
                    $result_data_ketetapan[$column_setting->judul_kolom] = $column_result_ketetapan;
                    // jika dari ketetapan, pjprk, akan dicari berdasarkan nomor PRK
                }
            }
            // dd('5');
            // dd($result_data);
            // dd($result_data_ketetapan);

            if (empty($result_data['Keterangan'])) {
                if ($distrik->name == 'UBJOM LUAR JAWA -1' || $distrik->name == 'UBJOM LUAR JAWA -2') {
                    $notification_failed = 'File RKAU untuk distrik ' . $distrik->name . ' tahun ' . $input_tahun . ' belum diunggah!';
                } else {
                    $notification_failed = 'File RKAU untuk distrik ' . $distrik->name . ' lokasi ' . $input_lokasi->name . ' tahun ' . $input_tahun . ' belum diunggah!';
                }

                return view('pengendalian_output.lr.index', compact('input_tahun', 'distrik', 'lokasi', 'nama_bln_dipilih', 'notification_failed', 'input_lokasi'));
            }

            $no_utama = $no_sub_1 = $no_sub_2 = $no_sub_3 = 0;

            foreach ($result_data['Keterangan'] as $key => $value) {
                $temp = array();

                // remove numerics and dots from keterangan
                $words = preg_replace('/[0-9]+/', '', $value);
                $words = str_replace('.', '', $words);
                $words = trim($words);
                //get the parent code of keterangan
                // dump($words);
                $parent_code = $this->get_parent_code($words, $strategi_bisnis);
                // dump($parent_code);
                //get keterangan indentation & number
                $number_indentation = $this->get_keterangan_number_indentation($key, $no_utama, $no_sub_1, $no_sub_2, $no_sub_3);
                // dump($number_indentation);
                $no_utama = $number_indentation['no_utama'];
                $no_sub_1 = $number_indentation['no_sub_1'];
                $no_sub_2 = $number_indentation['no_sub_2'];
                $no_sub_3 = $number_indentation['no_sub_3'];

                $result_data['Keterangan'][$key] = $number_indentation['number_indentation'] . $words;

                // $realisasi = $parent_code != '' ? $this->get_realisasi($parent_code, $distrik, $input_tahun, $int_input_bulan) : 0;
                // dd('6');
                if ($distrik->name == 'UBJOM LUAR JAWA -1' || $distrik->name == 'UBJOM LUAR JAWA -2') {
                    foreach ($settings as $key_setting => $column_setting) {
                        // kolom yg ambil dari excel_data_revisi
                        if ($column_setting->pgdl_report_dashboard_source_id == 2)
                            $temp[$column_setting->judul_kolom] = !empty($result_data[$column_setting->judul_kolom][$key]) ? $result_data[$column_setting->judul_kolom][$key] : 0;

                        // kolom yg ambil dari hasil query pjprk_ao
                        elseif ($column_setting->pgdl_report_dashboard_source_id == 4) {
                            if ($key == 66)
                                $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_realisasi_produksi_penjualan($input_tahun, $input_bulan, $distrik, 5);
                            elseif ($key == 67)
                                $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_realisasi_produksi_penjualan($input_tahun, $input_bulan, $distrik, 6);
                            elseif ($key == 68)
                                $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_realisasi_produksi_penjualan($input_tahun, $input_bulan, $distrik, 7);
                            elseif ($key == 69)
                                $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_realisasi_produksi_penjualan($input_tahun, $input_bulan, $distrik, 8);
                            else
                                $temp[$column_setting->judul_kolom] = $parent_code != '' ? $this->get_realisasi($parent_code, $distrik, $input_tahun, $int_input_bulan) : 0;
                        }

                        // hardcode
                        elseif ($column_setting->pgdl_report_dashboard_source_id == 5) {

                            // Hardcode untuk kolom RKAP s.d Bulan karena tiap baris rumusnya berbeda
                            if ($column_setting->judul_kolom == 'RKAP s.d Bulan') {
                                if ($key == 16)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 13);
                                elseif ($key == 17)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 14);
                                elseif ($key == 18)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 15);
                                elseif ($key == 19)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 16);
                                elseif ($key == 20)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 17);
                                elseif ($key == 22)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 20);
                                elseif ($key == 23)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 21);
                                elseif ($key == 29)
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 13) : $this->get_rkap_sd_bulan_per_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AO', 'C', 'D', 'AF', 'G', 'H', $distrik, 'HSD') + $this->get_rkap_sd_bulan_per_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AQ', 'C', 'D', 'AF', 'G', 'H', $distrik, 'HSD');
                                elseif ($key == 30)
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_rkap_sd_bulan_per_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AO', 'C', 'D', 'AF', 'G', 'H', $distrik, 'MFO') + $this->get_rkap_sd_bulan_per_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AQ', 'C', 'D', 'AF', 'G', 'H', $distrik, 'MFO');
                                elseif ($key == 31)
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_rkap_sd_bulan_per_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AO', 'C', 'D', 'AF', 'G', 'H', $distrik, 'IDO') + $this->get_rkap_sd_bulan_per_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AQ', 'C', 'D', 'AF', 'G', 'H', $distrik, 'IDO');
                                elseif ($key == 32)
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 14) : $this->get_rkap_sd_bulan_per_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AO', 'C', 'D', 'AF', 'G', 'H', $distrik, 'GAS ALAM') + $this->get_rkap_sd_bulan_per_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AQ', 'C', 'D', 'AF', 'G', 'H', $distrik, 'GAS ALAM');
                                elseif ($key == 33) {
                                    if ($strategi_bisnis->name == 'OM') {
                                        $temp[$column_setting->judul_kolom] = 0;
                                        for ($i = 15; $i <= 32; $i++) {
                                            $temp[$column_setting->judul_kolom] += $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', $i);
                                        }
                                    } else {
                                        $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_per_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AO', 'C', 'D', 'AF', 'G', 'H', $distrik, 'BATUBARA') + $this->get_rkap_sd_bulan_per_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AQ', 'C', 'D', 'AF', 'G', 'H', $distrik, 'BATUBARA');
                                    }
                                } elseif ($key == 34) {
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 33) : $this->get_rkap_sd_bulan_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AS', 'C', 'D', 'G', 'H', $distrik);
                                } elseif ($key == 35)
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 34) : $this->get_rkap_sd_bulan_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AT', 'C', 'D', 'G', 'H', $distrik);
                                elseif ($key == 36)
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_rkap_sd_bulan_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AO', 'C', 'D', 'G', 'H', $distrik) - $this->get_rkap_sd_bulan_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AN', 'C', 'D', 'G', 'H', $distrik);
                                elseif ($key == 37)
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_rkap_sd_bulan_bahan_bakar($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AN', 'C', 'D', 'G', 'H', $distrik);
                                elseif ($key == 40)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_form_6_10($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', 'I-Form 6', 'BA', 'C', 'C',  4, 'D', 'C', 5, 2, $distrik);
                                elseif ($key == 41)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_form_6_10($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', 'I-Form 6', 'BA', 'C', 'C',  4, 'D', 'C', 5, 3, $distrik) + $this->get_rkap_sd_bulan_form_6_10($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', 'I-Form 10', 'BB', 'C', 'C',  4, 'D', 'C', 5, 6, $distrik);
                                elseif ($key == 43)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_form_6_10($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', 'I-Form 6', 'BB', 'C', 'C',  4, 'D', 'C', 5, 2, $distrik);
                                elseif ($key == 44)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_form_6_10($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', 'I-Form 6', 'BB', 'C', 'C',  4, 'D', 'C', 5, 3, $distrik);
                                elseif ($key == 45)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PEG', 'M', 74);
                                elseif ($key == 47)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-ADM', 'M', 34);
                                elseif ($key == 48)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_biaya_usaha_lainnya($file_imports_pgdl, $input_tahun, $input_bulan, 'I-BIAYA USAHA LAINNYA', 'M', 'AN', 'C', 7);
                                elseif ($key == 55)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-DILUAR USAHA', 'M', 39);
                                elseif ($key == 56)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-DILUAR USAHA', 'M', 51);

                                else
                                    $temp[$column_setting->judul_kolom] = 0;
                            } else
                                $temp[$column_setting->judul_kolom] = 0;
                        }
                    }
                } else {
                    foreach ($settings as $key_setting => $column_setting) {
                        // kolom yg ambil dari excel_data_revisi
                        if ($column_setting->pgdl_report_dashboard_source_id == 1) {
                            // dd($file_imports_pgdl, $input_tahun, $input_bulan, $column_setting->kolom, $input_lokasi->id);
                            $temp[$column_setting->judul_kolom] = !empty($result_data_ketetapan[$column_setting->judul_kolom][$key]) ? $result_data_ketetapan[$column_setting->judul_kolom][$key] : 0;
                        } elseif ($column_setting->pgdl_report_dashboard_source_id == 2) {
                            $temp[$column_setting->judul_kolom] = !empty($result_data[$column_setting->judul_kolom][$key]) ? $result_data[$column_setting->judul_kolom][$key] : 0;
                        }

                        // kolom yg ambil dari hasil query pjprk_ao
                        elseif ($column_setting->pgdl_report_dashboard_source_id == 4) {
                            // dd('8');
                            if ($key == 66)
                                $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_realisasi_produksi_penjualan_non_luar_jawa($input_tahun, $input_bulan, $distrik, 5, $input_lokasi->id);
                            elseif ($key == 67)
                                $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_realisasi_produksi_penjualan_non_luar_jawa($input_tahun, $input_bulan, $distrik, 6, $input_lokasi->id);
                            elseif ($key == 68)
                                $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_realisasi_produksi_penjualan_non_luar_jawa($input_tahun, $input_bulan, $distrik, 7, $input_lokasi->id);
                            elseif ($key == 69)
                                $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_realisasi_produksi_penjualan_non_luar_jawa($input_tahun, $input_bulan, $distrik, 8, $input_lokasi->id);
                            else
                                // change request laba rugi ambil data dari plj prk ai pln
                                if ($column_setting->judul_kolom == 'REALISASI s.d Bulan') {
                                    // $temp[$column_setting->judul_kolom] = $parent_code != '' ? $this->get_realisasi_non_luar_jawa($parent_code, $distrik, $input_tahun, $int_input_bulan, $input_lokasi->id) : 0;
                                    $temp[$column_setting->judul_kolom] = LabaRugiService::get_data_realisasi_msf900($strategi_bisnis->name, $key, $parent_code, $distrik, $input_tahun, $int_input_bulan, $input_lokasi->id);
                                }
                            // end change request laba rugi ambil data dari plj prk ai pln
                        }

                        // hardcode
                        elseif ($column_setting->pgdl_report_dashboard_source_id == 5) {
                            // Hardcode untuk kolom RKAP s.d Bulan karena tiap baris rumusnya berbeda
                            // dd('10');
                            if ($column_setting->judul_kolom == 'RKAP s.d Bulan') {
                                if ($key == 16)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 13, $distrik, $input_lokasi->id);
                                elseif ($key == 17)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 14, $distrik, $input_lokasi->id);
                                elseif ($key == 18)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 15, $distrik, $input_lokasi->id);
                                elseif ($key == 19)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 16, $distrik, $input_lokasi->id);
                                elseif ($key == 20)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 17, $distrik, $input_lokasi->id);
                                elseif ($key == 22)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 20, $distrik, $input_lokasi->id);
                                elseif ($key == 23)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 21, $distrik, $input_lokasi->id);
                                elseif ($key == 28)
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_bahan_bakar_om($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PENDUKUNG EP', 'K', 37, $distrik, $input_lokasi->id) : 0;
                                elseif ($key == 29) // change request september 2020 poin bahan bakar s/d bulan sesuai prefix nilainya belum keluar, kodingan lama dikomen aja, terus diganti dengan kodingan baru
                                    // $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 13, $distrik, $input_lokasi->id) : $this->get_rkap_sd_bulan_per_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AO', 'C', 'D', 'AF', 'G', 'H', $distrik, 'HSD', $input_lokasi->id) + $this->get_rkap_sd_bulan_per_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AQ', 'C', 'D', 'AF', 'G', 'H', $distrik, 'HSD', $input_lokasi->id);
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_bahan_bakar_om_by_prefix($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PENDUKUNG EP', 'K', 13, $distrik, $input_lokasi->id, ['3A0001', '5A0001']) : $this->form_input_bahan_bakar($distrik, $input_tahun, $input_bulan, ['2A0001']);
                                elseif ($key == 30)
                                    // $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_rkap_sd_bulan_per_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AO', 'C', 'D', 'AF', 'G', 'H', $distrik, 'MFO', $input_lokasi->id) + $this->get_rkap_sd_bulan_per_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AQ', 'C', 'D', 'AF', 'G', 'H', $distrik, 'MFO', $input_lokasi->id);
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_bahan_bakar_om_by_prefix($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PENDUKUNG EP', 'K', 13, $distrik, $input_lokasi->id, ['3A0002', '5A0002']) : $this->form_input_bahan_bakar($distrik, $input_tahun, $input_bulan, ['2A0002']);
                                elseif ($key == 31)
                                    // $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_rkap_sd_bulan_per_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AO', 'C', 'D', 'AF', 'G', 'H', $distrik, 'IDO', $input_lokasi->id) + $this->get_rkap_sd_bulan_per_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AQ', 'C', 'D', 'AF', 'G', 'H', $distrik, 'IDO', $input_lokasi->id);
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_bahan_bakar_om_by_prefix($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PENDUKUNG EP', 'K', 13, $distrik, $input_lokasi->id, ['3A0003', '5A0005']) : $this->form_input_bahan_bakar($distrik, $input_tahun, $input_bulan, ['2A0003']);
                                elseif ($key == 32)
                                    // $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 14, $distrik, $input_lokasi->id) : $this->get_rkap_sd_bulan_per_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AO', 'C', 'D', 'AF', 'G', 'H', $distrik, 'GAS ALAM', $input_lokasi->id) + $this->get_rkap_sd_bulan_per_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AQ', 'C', 'D', 'AF', 'G', 'H', $distrik, 'GAS ALAM', $input_lokasi->id);
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_bahan_bakar_om_by_prefix($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PENDUKUNG EP', 'K', 13, $distrik, $input_lokasi->id, ['3B', '5B']) : $this->form_input_bahan_bakar($distrik, $input_tahun, $input_bulan, ['2B']);
                                elseif ($key == 33) {
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_bahan_bakar_om_by_prefix($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PENDUKUNG EP', 'K', 13, $distrik, $input_lokasi->id, ['3C', '5C']) : $this->form_input_bahan_bakar($distrik, $input_tahun, $input_bulan, ['2C']);
                                    // if($strategi_bisnis->name == 'OM'){
                                    //     $temp[$column_setting->judul_kolom] = 0;
                                    //     for($i = 15; $i<=32; $i++){
                                    //         $temp[$column_setting->judul_kolom] += $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', $i, $distrik, $input_lokasi->id);
                                    //     }
                                    // }
                                    // else{
                                    //     $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_per_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AO', 'C', 'D', 'AF', 'G', 'H', $distrik, 'BATUBARA', $input_lokasi->id) + $this->get_rkap_sd_bulan_per_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AQ', 'C', 'D', 'AF', 'G', 'H', $distrik, 'BATUBARA', $input_lokasi->id);
                                    // }
                                } elseif ($key == 34) {
                                    // $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 33, $distrik, $input_lokasi->id) : $this->get_rkap_sd_bulan_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AS', 'C', 'D', 'G', 'H', $distrik, $input_lokasi->id);
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_bahan_bakar_om_by_prefix($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PENDUKUNG EP', 'K', 13, $distrik, $input_lokasi->id, ['3D', '5D']) : $this->form_input_bahan_bakar($distrik, $input_tahun, $input_bulan, ['2D']);
                                } elseif ($key == 35)
                                    // $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Pendapatan', 'M', 34, $distrik, $input_lokasi->id) : $this->get_rkap_sd_bulan_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AT', 'C', 'D', 'G', 'H', $distrik, $input_lokasi->id);
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_bahan_bakar_om_by_prefix($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PENDUKUNG EP', 'K', 13, $distrik, $input_lokasi->id, ['3E', '5E']) : $this->form_input_bahan_bakar($distrik, $input_tahun, $input_bulan, ['2E']);
                                elseif ($key == 36)
                                    // $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_rkap_sd_bulan_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AO', 'C', 'D', 'G', 'H', $distrik, $input_lokasi->id) - $this->get_rkap_sd_bulan_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AN', 'C', 'D', 'G', 'H', $distrik, $input_lokasi->id);
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_bahan_bakar_om_by_prefix($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PENDUKUNG EP', 'K', 13, $distrik, $input_lokasi->id, ['3F0002', '5F0002', '3F0003', '5F0003']) : $this->form_input_bahan_bakar($distrik, $input_tahun, $input_bulan, ['2F0002', '2F0003']);
                                elseif ($key == 37) // pajak permukaan air , END bahan bakar sampai dengan bulan sesuai prefix
                                    // $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? 0 : $this->get_rkap_sd_bulan_bahan_bakar_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'Database KIT (P+S+I)', 'AN', 'C', 'D', 'G', 'H', $distrik, $input_lokasi->id);
                                    $temp[$column_setting->judul_kolom] = $strategi_bisnis->name == 'OM' ? $this->get_bahan_bakar_om_by_prefix($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PENDUKUNG EP', 'K', 13, $distrik, $input_lokasi->id, ['3F0001', '5F0001']) : $this->form_input_bahan_bakar($distrik, $input_tahun, $input_bulan, ['2F0001']);
                                elseif ($key == 40)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_form_6_10_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', 'I-Form 6', 'BA', 'C', 'C',  4, 'D', 'C', 5, 2, $distrik, $input_lokasi->id);
                                elseif ($key == 41)
                                    // $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_form_6_10_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', 'I-Form 6', 'BA', 'C', 'C',  4, 'D', 'C', 5, 3, $distrik, $input_lokasi->id) + $this->get_rkap_sd_bulan_form_6_10_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', 'I-Form 10', 'AX', 'C', 'C',  4, 'D', 'C', 5, 6, $distrik, $input_lokasi->id);
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_form_6_10_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', 'I-Form 6', 'BA', 'C', 'C',  4, 'D', 'C', 5, 3, $distrik, $input_lokasi->id) + $this->get_form_10_ai_pln($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', 'I-Form 10', 'AX', 'C', 'C',  4, 'D', 'C', 5, 6, $distrik, $input_lokasi->id);
                                elseif ($key == 43)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_form_6_10_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', 'I-Form 6', 'BB', 'C', 'C',  4, 'D', 'C', 5, 2, $distrik, $input_lokasi->id);
                                elseif ($key == 44)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_form_6_10_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-LR', 'I-Form 6', 'BB', 'C', 'C',  4, 'D', 'C', 5, 3, $distrik, $input_lokasi->id); // end pemeliharaan
                                elseif ($key == 46) // bug fixing change request september 2020 poin penyusutan rekap s/d bulan nilainya masih belum sesuai,
                                    $temp[$column_setting->judul_kolom] = $this->get_penyusutan_sd_bulan($file_imports_pgdl, $input_tahun, $input_bulan, 'I-Penyusutan', 'Q', 13, $distrik, $input_lokasi->id); // END
                                elseif ($key == 45) // bug fixing change request september 2020 poin kepegawaian rekap s/d bulan nilainya masih belum sesuai,
                                    // $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PEG', 'M', 74, $distrik, $input_lokasi->id); // END
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_ipeg($file_imports_pgdl, $input_tahun, $input_bulan, 'I-PEG', 'M', 74, $distrik, $input_lokasi->id); // END
                                elseif ($key == 47)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-ADM', 'M', 34, $distrik, $input_lokasi->id);
                                elseif ($key == 48)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_biaya_usaha_lainnya_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-BIAYA USAHA LAINNYA', 'M', 'AN', 'C', 7, $distrik, $input_lokasi->id);
                                elseif ($key == 55)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-DILUAR USAHA', 'M', 39, $distrik, $input_lokasi->id);
                                elseif ($key == 56)
                                    $temp[$column_setting->judul_kolom] = $this->get_rkap_sd_bulan_non_luar_jawa($file_imports_pgdl, $input_tahun, $input_bulan, 'I-DILUAR USAHA', 'M', 51, $distrik, $input_lokasi->id);
                                else
                                    $temp[$column_setting->judul_kolom] = 0;

                                // DEBUG:
                                // if ($key == 46) {
                                //     dd(384, $column_setting->judul_kolom, $temp[$column_setting->judul_kolom],
                                //         compact('temp', 'file_imports_pgdl', 'input_tahun', 'input_bulan', 'distrik', 'input_lokasi')
                                //     );
                                // }

                            } else
                                $temp[$column_setting->judul_kolom] = 0;
                        }
                    }
                }
                $lr_result[$key] = $temp;
            }

            foreach ($settings as $key => $column_setting) {
                if ($column_setting->judul_kolom != 'Keterangan' && $column_setting->judul_kolom != 'PENCAPAIAN s.d Bulan' && $column_setting->judul_kolom != 'PENCAPAIAN n update' && $column_setting->judul_kolom != 'RKAP n' && $column_setting->judul_kolom != 'RKAP n update') {

                    // penjumlahan
                    for ($i = 16; $i <= 20; $i++) {
                        $lr_result[15][$column_setting->judul_kolom] += $lr_result[$i][$column_setting->judul_kolom];
                    }
                    $lr_result[21][$column_setting->judul_kolom] = $lr_result[22][$column_setting->judul_kolom] + $lr_result[23][$column_setting->judul_kolom];
                    $lr_result[14][$column_setting->judul_kolom] = $lr_result[15][$column_setting->judul_kolom] + $lr_result[21][$column_setting->judul_kolom] + $lr_result[24][$column_setting->judul_kolom];

                    for ($i = 29; $i <= 37; $i++) {
                        $lr_result[28][$column_setting->judul_kolom] += $lr_result[$i][$column_setting->judul_kolom];
                    }
                    $lr_result[42][$column_setting->judul_kolom] = $lr_result[43][$column_setting->judul_kolom] + $lr_result[44][$column_setting->judul_kolom];
                    $lr_result[39][$column_setting->judul_kolom] = $lr_result[40][$column_setting->judul_kolom] + $lr_result[41][$column_setting->judul_kolom];
                    $lr_result[38][$column_setting->judul_kolom] = $lr_result[39][$column_setting->judul_kolom] + $lr_result[42][$column_setting->judul_kolom];

                    $lr_result[26][$column_setting->judul_kolom] = $lr_result[28][$column_setting->judul_kolom] + $lr_result[38][$column_setting->judul_kolom] + $lr_result[45][$column_setting->judul_kolom] + $lr_result[46][$column_setting->judul_kolom] + $lr_result[47][$column_setting->judul_kolom] + $lr_result[48][$column_setting->judul_kolom];
                    $lr_result[51][$column_setting->judul_kolom] = $lr_result[14][$column_setting->judul_kolom] - $lr_result[26][$column_setting->judul_kolom];
                    for ($i = 54; $i <= 58; $i++) {
                        $lr_result[53][$column_setting->judul_kolom] += $lr_result[$i][$column_setting->judul_kolom];
                    }
                    $lr_result[59][$column_setting->judul_kolom] = $lr_result[51][$column_setting->judul_kolom] + $lr_result[53][$column_setting->judul_kolom];
                    for ($i = 59; $i <= 61; $i++) {
                        $lr_result[62][$column_setting->judul_kolom] += $lr_result[$i][$column_setting->judul_kolom];
                    }
                    $lr_result[64][$column_setting->judul_kolom] = $lr_result[62][$column_setting->judul_kolom] - $lr_result[63][$column_setting->judul_kolom];

                    // khusus baris 68 & 69, bukan hasil pembagian dari baris lain
                    if ($column_setting->judul_kolom != 'REALISASI s.d Bulan') {
                        $lr_result[69][$column_setting->judul_kolom] = $lr_result[68][$column_setting->judul_kolom] == 0 ? 0 : $lr_result[15][$column_setting->judul_kolom] / $lr_result[68][$column_setting->judul_kolom];
                        $lr_result[70][$column_setting->judul_kolom] = $lr_result[68][$column_setting->judul_kolom] == 0 ? 0 : ($lr_result[26][$column_setting->judul_kolom] - $lr_result[48][$column_setting->judul_kolom]) / $lr_result[68][$column_setting->judul_kolom];
                    }
                }
            }
            // dd($lr_result);
            foreach ($lr_result as $key => $value) {
                // hardcode untuk kolom pencapaian sd Bulan dan Pencapaian n update
                $lr_result[$key]['PENCAPAIAN s.d Bulan'] = $lr_result[$key]['RKAP s.d Bulan'] == 0 ? 0 : ceil(($lr_result[$key]['REALISASI s.d Bulan'] / $lr_result[$key]['RKAP s.d Bulan']) * 100);

                $lr_result[$key]['PENCAPAIAN n update'] = $lr_result[$key]['RKAP n update'] == 0 ? 0 : ceil(($lr_result[$key]['REALISASI s.d Bulan'] / $lr_result[$key]['RKAP n update']) * 100);
            }

            if ($request->type) {
                if ($request->type == 'excel') {
                    if ($distrik->name == 'UBJOM LUAR JAWA -1' || $distrik->name == 'UBJOM LUAR JAWA -2') {
                        Excel::create('Laba Rugi', function ($excel) use ($lr_result, $input_tahun, $distrik, $lokasi, $nama_bln_dipilih, $settings, $strategi_bisnis) {
                            $excel->setTitle('Laba Rugi');
                            $excel->setCreator('Laravel')->setCompany('Profio', 'PJB');
                            $excel->setDescription('Laba Rugi');
                            $excel->sheet('Laba Rugi', function ($sheet) use ($lr_result, $input_tahun, $distrik, $lokasi, $nama_bln_dipilih, $settings, $strategi_bisnis) {
                                $sheet->loadView('pengendalian_output.lr.excel', compact('lr_result', 'input_tahun', 'distrik', 'lokasi', 'nama_bln_dipilih', 'settings', 'strategi_bisnis'));
                            });
                        })->download('xlsx');
                    } else {
                        Excel::create('Laba Rugi', function ($excel) use ($lr_result, $input_tahun, $distrik, $lokasi, $nama_bln_dipilih, $settings, $strategi_bisnis, $input_lokasi) {
                            $excel->setTitle('Laba Rugi');
                            $excel->setCreator('Laravel')->setCompany('Profio', 'PJB');
                            $excel->setDescription('Laba Rugi');
                            $excel->sheet('Laba Rugi', function ($sheet) use ($lr_result, $input_tahun, $distrik, $lokasi, $nama_bln_dipilih, $settings, $strategi_bisnis, $input_lokasi) {
                                $sheet->loadView('pengendalian_output.lr.excel', compact('lr_result', 'input_tahun', 'distrik', 'lokasi', 'nama_bln_dipilih', 'settings', 'strategi_bisnis', 'input_lokasi'));
                            });
                        })->download('xlsx');
                    }
                }
            }
            return view('pengendalian_output.lr.index', compact('lr_result', 'input_tahun', 'distrik', 'lokasi', 'nama_bln_dipilih', 'settings', 'row_utama', 'row_sub_1', 'row_sub_2', 'input_lokasi'));
        }
    }

    // change request Mei 2021 Form input bahan bakar
    public function form_input_bahan_bakar($distrik, $tahun, $bulan, $prefix)
    {
        for ($i = 0; $i < count($prefix); $i++) {
            $data = DB::select("select e.value from excel_data_input_bahan_bakar e join 
                                file_input_bahan_bakar f on f.id = e.file_input_bahan_bakar_id 
                                where f.tahun = '" . $tahun . "'
                                and e.prk like '%" . $prefix[$i] . "%'
                                and e.distrik_id = " . $distrik->id . " 
                                and e.month <= " . $bulan . "
                             ");
        }

        if (empty($data)) {
            return 0;
        } else {
            $result = 0;
            foreach ($data as $key => $value) {
                $result += $value->value;
            }

            return $result;
        }
    }

    // change request september 2020
    function get_rkap_sd_bulan_ipeg($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name, $start_kolom, $row, $distrik, $lokasi_id)
    {
        $columns = $this->get_column_array($start_kolom, $bulan, 1);

        $data = DB::select("select e.row, coalesce(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) as value
            from pgdl_excel_datas_revisi e
            join pgdl_sheets s on e.pgdl_sheet_id = s.id
            where e.pgdl_file_import_revisi_id in " . $pgdl_file_import_revisi_id . "
            and e.lokasi_id = " . $lokasi_id . "
            and e.row = " . $row . "
            and e.kolom in " . $columns . "
            and s.name like '" . $sheet_name . "'
            group by e.row
            order by e.row;");

        // dd($pgdl_file_import_revisi_id, $lokasi_id, $row, $columns, $sheet_name);
        // if ($sheet_name == 'I-Penyusutan') {
        //     dd(compact('data'), "select e.row, coalesce(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) as value
        //         from pgdl_excel_datas_revisi e
        //         join pgdl_sheets s on e.pgdl_sheet_id = s.id
        //         where e.pgdl_file_import_revisi_id in ".$pgdl_file_import->form_penyusutan_pgdl_file_import_revisi_id."
        //         and e.lokasi_id = ".$lokasi_id."
        //         and e.row = ".$row."
        //         and e.kolom in ".$columns."
        //         and s.name like '".$sheet_name."'
        //         group by e.row
        //         order by e.row;");
        // }

        $value = !empty($data) ? $data[0]->value : 0;
        return $value;
    } // end change request september 2020
    // change request september 2020
    function get_form_10_ai_pln($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name_rkau, $sheet_name_form, $start_kolom, $search_column1, $search_cell_column_1, $search_cell_row_1, $search_column2, $search_cell_column_2, $search_cell_row_2, $jenis_id, $distrik, $lokasi_id)
    {

        $columns = $this->get_column_array_non_luar_jawa($start_kolom, $bulan, 1);
        if ($jenis_id == 2)
            $form_id = $this->get_file_import_revisi_non_luar_jawa($pgdl_file_import_revisi_id, 'form6_rutin_pgdl_file_import_revisi_id');
        elseif ($jenis_id == 3)
            $form_id = $this->get_file_import_revisi_non_luar_jawa($pgdl_file_import_revisi_id, 'form6_reimburse_pgdl_file_import_revisi_id');
        // elseif($jenis_id == 6)
        else
            $form_id = $this->get_file_import_revisi_non_luar_jawa($pgdl_file_import_revisi_id, 'form10_pln_pgdl_file_import_revisi_id');

        // if($jenis_id == 6) $columns = "('AX','AY','AZ','BA','BB','BC','BD','BE','BF','BH','BI')";

        if ($form_id == NULL)
            return 0;

        $data = DB::select("select COALESCE(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) AS value
                            FROM pgdl_excel_datas_revisi e
                            JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                            WHERE pgdl_file_import_revisi_id in " . $form_id . "
                            AND s.name like '" . $sheet_name_form . "'
                            AND e.lokasi_id = " . $lokasi_id . "
                            AND kolom in " . $columns . "
                            AND row in (
                                SELECT row
                                FROM pgdl_excel_datas_revisi e
                                JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                                WHERE pgdl_file_import_revisi_id in " . $form_id . "
                                AND s.name like '" . $sheet_name_form . "'
                                AND e.lokasi_id = " . $lokasi_id . "
                                AND kolom like '" . $search_column1 . "'
                                AND value like '" . $distrik->code1 . "'
                                AND row in (
                                    SELECT row
                                    FROM pgdl_excel_datas_revisi e
                                    JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                                    WHERE pgdl_file_import_revisi_id in " . $form_id . "
                                    AND s.name like '" . $sheet_name_form . "'
                                    AND e.lokasi_id = " . $lokasi_id . "
                                    AND kolom like '" . $search_column2 . "'
                                    AND value like (
                                        SELECT value FROM pgdl_excel_datas_revisi e
                                        JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                                        WHERE pgdl_file_import_revisi_id in " . $pgdl_file_import_revisi_id . "
                                        AND s.name like '" . $sheet_name_rkau . "'
                                        AND e.lokasi_id = " . $lokasi_id . "
                                        AND kolom like '" . $search_cell_column_2 . "'
                                        AND row = " . $search_cell_row_2 . "
                                    )
                                )
                            )");

        $value = !empty($data) ? $data[0]->value : 0;
        return $value;
    }
    // end change request september 2020
    // change request september 2020
    public function get_bahan_bakar_om_by_prefix($pgdl_file_import_revisi_id, $input_tahun, $bulan, $sheet_name, $start_kolom, $row, $distrik, $lokasi_id, $prefix)
    {
        # code...
        $prk_kolom = 'C';
        $columns = $this->get_column_array($start_kolom, $bulan, 1);

        for ($i = 0; $i < count($prefix); $i++) {
            # code...
            $data[] = DB::select("select e.value from pgdl_excel_datas_revisi e
                            join pgdl_sheets s on e.pgdl_sheet_id = s.id
                            where e.pgdl_file_import_revisi_id in (" . $pgdl_file_import_revisi_id . ")
                            and e.lokasi_id = " . $lokasi_id . "
                            and s.name like '" . $sheet_name . "'
                            and e.kolom in " . $columns . "
                            and row in
                                (
                                    select e.row from pgdl_excel_datas_revisi e
                                    join pgdl_sheets s on e.pgdl_sheet_id = s.id
                                    where e.pgdl_file_import_revisi_id in (" . $pgdl_file_import_revisi_id . ")
                                    and e.lokasi_id = " . $lokasi_id . "
                                    and s.name like '" . $sheet_name . "'
                                    and e.kolom = '" . $prk_kolom . "'
                                    and e.value like '%" . $prefix[$i] . "%'
                                )
                        ");
        }

        if (empty($data)) {
            return 0;
        } else {
            $result = 0;
            foreach ($data as $key => $value) {
                # code...
                foreach ($value as $key => $item) {
                    # code...
                    $result += $item->value;
                }
            }

            return $result;
            // return collect($data)->sum('value');
        }

        // $value = !empty($data) ? $data[0]->value : 0;
        // return $value;
    }
    // end change request september 2020

    public function get_bahan_bakar_om($pgdl_file_import_revisi_id, $input_tahun, $bulan, $sheet_name, $start_kolom, $row, $distrik, $lokasi_id)
    {
        # code...
        $columns = $this->get_column_array($start_kolom, $bulan, 1);

        // $pgdl_file_import = DB::table("pgdl_file_imports_revisi")->whereRaw("id in ".$pgdl_file_import_revisi_id)->first();

        // if (empty($pgdl_file_import)) {
        //     return 0;
        // }

        $data = DB::select("select e.row, coalesce(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) as value
            from pgdl_excel_datas_revisi e
            join pgdl_sheets s on e.pgdl_sheet_id = s.id
            where e.pgdl_file_import_revisi_id in (" . $pgdl_file_import_revisi_id . ")
            and e.lokasi_id = " . $lokasi_id . "
            and e.row = " . $row . "
            and e.kolom in " . $columns . "
            and s.name like '" . $sheet_name . "'
            group by e.row
            order by e.row;");

        if (empty($data)) {
            return 0;
        } else {
            return collect($data)->sum('value');
        }

        $value = !empty($data) ? $data[0]->value : 0;
        return $value;
    }

    function get_data_ketetapan($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name, $start_kolom, $row, $lokasi_id)
    {
        // dd($pgdl_file_import_revisi_id);
        $id = DB::select("select * from pgdl_file_imports_revisi e
                where e.id in " . $pgdl_file_import_revisi_id . "
                ;");

        $datas = DB::select("select e.row, e.value
                    from excel_datas_ketetapan e
                    join sheets s on s.id = e.sheet_id
                    where s.name = '" . $sheet_name . "'
                    and e.file_import_ketetapan_id = " . $id[0]->file_import_ketetapan_id . "
                    and e.kolom = '" . $start_kolom . "'
                    and e.lokasi_id = " . $lokasi_id . "
                    and e.row > 12
                    order by e.row;");
        // dd($datas);
        if ($datas) {
            $results = [];
            foreach ($datas as $key => $value) {
                $results[$value->row] = $value->value;
            }
            // dd($results);
            return $results;
        }
        return $datas;
        // $value = !empty($data) ? $data[0]->value : 0;
        // return $value;
    }

    function get_file_id_pengendalian_non_luar_jawa($jenis_id, $tahun_anggaran, $distrik_id, $lokasi_id)
    {
        $files = DB::select("select p.id
                        from pgdl_file_imports_revisi p
                        join pgdl_templates t on t.id = p.pgdl_template_id
                        where t.jenis_id = " . $jenis_id . "
                        and p.tahun=" . $tahun_anggaran . "
                        and p.distrik_id = " . $distrik_id . "
                        and p.lokasi_id=" . $lokasi_id . ";");

        if ($files) {
            $res = [];
            $i = 0;
            foreach ($files as $key => $value) {
                $res[$i] = $value->id;
                $i++;
            }
            $res = implode(",", $res);
            //dd(var_dump($new));
            $res = "(" . $res . ")";
            return $res;
        }
        return $files;
    }

    function get_data_pengendalian_non_luar_jawa($file_id, $sheet_name, $kolom, $lokasi_id)
    {

        $datas = DB::select("select e.row, e.value
                            from pgdl_excel_datas_revisi e
                            join pgdl_sheets s on s.id = e.pgdl_sheet_id
                            where s.name = '" . $sheet_name . "'
                            and e.pgdl_file_import_revisi_id in " . $file_id . "
                            and e.kolom = '" . $kolom . "'
                            and e.lokasi_id = " . $lokasi_id . "
                            and e.row > 12
                            order by e.row;");

        if ($datas) {
            $results = [];
            foreach ($datas as $key => $value) {
                $results[$value->row] = $value->value;
            }
            return $results;
        }
        return $datas;
    }

    function get_parent_code_non_luar_jawa($keterangan, $strategi_bisnis)
    {
        if ($strategi_bisnis->name == 'OM') {
            $data = PgdlLRParentCode::where('keterangan', 'like', "%" . $keterangan . "%")
                ->whereNotIn('kode_parent_om', ['#', '-'])
                ->first();
        } else {
            $data = PgdlLRParentCode::where('keterangan', 'like', "%" . $keterangan . "%")
                ->whereNotIn('kode_parent_up', ['#', '-'])
                ->first();
        }
        // dd($data);
        $parent_code = !empty($data) ? $data->kode_parent_up : '';
        // dd( $parent_code);
        return $parent_code;
    }

    function get_realisasi_non_luar_jawa($parent, $distrik, $year, $month, $lokasi_id)
    {

        $data = PgdlPljPrkAo::selectRaw('dstrct_code, sum(tran_amount) as value')
            ->where('dstrct_code', $distrik->code1)
            ->where('years', $year)
            ->where('months', '<=', $month)
            ->where('project_no', 'like', "%" . $parent . "%")
            ->groupBy('dstrct_code')
            ->first();

        $value = !empty($data) ? $data->value : 0;
        return $value;
    }

    function get_rkap_sd_bulan_non_luar_jawa($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name, $start_kolom, $row, $distrik, $lokasi_id)
    {
        $columns = $this->get_column_array($start_kolom, $bulan, 1);

        $data = DB::select("select e.row, coalesce(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) as value
            from pgdl_excel_datas_revisi e
            join pgdl_sheets s on e.pgdl_sheet_id = s.id
            where e.pgdl_file_import_revisi_id in " . $pgdl_file_import_revisi_id . "
            and e.lokasi_id = " . $lokasi_id . "
            and e.row = " . $row . "
            and e.kolom in " . $columns . "
            and s.name like '" . $sheet_name . "'
            group by e.row
            order by e.row;");

        // if ($sheet_name == 'I-Penyusutan') {
        //     dd(compact('data'), "select e.row, coalesce(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) as value
        //         from pgdl_excel_datas_revisi e
        //         join pgdl_sheets s on e.pgdl_sheet_id = s.id
        //         where e.pgdl_file_import_revisi_id in ".$pgdl_file_import->form_penyusutan_pgdl_file_import_revisi_id."
        //         and e.lokasi_id = ".$lokasi_id."
        //         and e.row = ".$row."
        //         and e.kolom in ".$columns."
        //         and s.name like '".$sheet_name."'
        //         group by e.row
        //         order by e.row;");
        // }

        $value = !empty($data) ? $data[0]->value : 0;
        return $value;
    }
    // change request september 2020
    function get_penyusutan_sd_bulan($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name, $start_kolom, $row, $distrik, $lokasi_id)
    {
        $columns = $this->get_column_array($start_kolom, $bulan, 1);

        $pgdl_file_import = DB::table("pgdl_file_imports_revisi")->whereRaw("id in " . $pgdl_file_import_revisi_id)->first();

        if (empty($pgdl_file_import)) {
            return 0;
        }

        $data = DB::select("select e.row, coalesce(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) as value
            from pgdl_excel_datas_revisi e
            join pgdl_sheets s on e.pgdl_sheet_id = s.id
            where e.pgdl_file_import_revisi_id in (" . $pgdl_file_import->form_penyusutan_pgdl_file_import_revisi_id . ")
            and e.lokasi_id = " . $lokasi_id . "
            and e.row = " . $row . "
            and e.kolom in " . $columns . "
            and s.name like '" . $sheet_name . "'
            group by e.row
            order by e.row;");

        if (empty($data)) {
            return 0;
        } else {
            return collect($data)->sum('value');
        }

        $value = !empty($data) ? $data[0]->value : 0;
        return $value;
    }
    // end change request september 2020

    function get_rkap_sd_bulan_biaya_usaha_lainnya_non_luar_jawa($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name, $start_kolom, $search_column, $search_cell_column, $search_cell_row, $distrik, $lokasi_id)
    {
        $columns = $this->get_column_array($start_kolom, $bulan, 1);

        $data = DB::select("select COALESCE(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) as value
                from pgdl_excel_datas_revisi e
                join pgdl_sheets s on e.pgdl_sheet_id = s.id
                where pgdl_file_import_revisi_id IN " . $pgdl_file_import_revisi_id . "
                and s.name = '" . $sheet_name . "'
                and e.lokasi_id = " . $lokasi_id . "
                and kolom in " . $columns . "
                and row in (
                    select row
                    from pgdl_excel_datas_revisi e
                    join pgdl_sheets s on e.pgdl_sheet_id = s.id
                    where pgdl_file_import_revisi_id IN " . $pgdl_file_import_revisi_id . "
                    and s.name = '" . $sheet_name . "'
                    and e.lokasi_id = " . $lokasi_id . "
                    and kolom like '" . $search_column . "'
                    and value in (
                        select value
                        from pgdl_excel_datas_revisi e
                        join pgdl_sheets s on e.pgdl_sheet_id = s.id
                        where pgdl_file_import_revisi_id IN " . $pgdl_file_import_revisi_id . "
                        and s.name = '" . $sheet_name . "'
                        and e.lokasi_id = " . $lokasi_id . "
                        and kolom like '" . $search_cell_column . "'
                        and row = " . $search_cell_row . "
                    )
                )");
        $value = !empty($data) ? $data[0]->value : 0;
        return $value;
    }

    function get_rkap_sd_bulan_form_6_10_non_luar_jawa($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name_rkau, $sheet_name_form, $start_kolom, $search_column1, $search_cell_column_1, $search_cell_row_1, $search_column2, $search_cell_column_2, $search_cell_row_2, $jenis_id, $distrik, $lokasi_id)
    {

        $columns = $this->get_column_array_non_luar_jawa($start_kolom, $bulan, 2);
        if ($jenis_id == 2)
            $form_id = $this->get_file_import_revisi_non_luar_jawa($pgdl_file_import_revisi_id, 'form6_rutin_pgdl_file_import_revisi_id');
        elseif ($jenis_id == 3)
            $form_id = $this->get_file_import_revisi_non_luar_jawa($pgdl_file_import_revisi_id, 'form6_reimburse_pgdl_file_import_revisi_id');
        // elseif($jenis_id == 6)
        else
            $form_id = $this->get_file_import_revisi_non_luar_jawa($pgdl_file_import_revisi_id, 'form10_pln_pgdl_file_import_revisi_id');

        if ($form_id == NULL)
            return 0;

        $data = DB::select("select COALESCE(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) AS value
                            FROM pgdl_excel_datas_revisi e
                            JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                            WHERE pgdl_file_import_revisi_id in " . $form_id . "
                            AND s.name like '" . $sheet_name_form . "'
                            AND e.lokasi_id = " . $lokasi_id . "
                            AND kolom in " . $columns . "
                            AND row in (
                                SELECT row
                                FROM pgdl_excel_datas_revisi e
                                JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                                WHERE pgdl_file_import_revisi_id in " . $form_id . "
                                AND s.name like '" . $sheet_name_form . "'
                                AND e.lokasi_id = " . $lokasi_id . "
                                AND kolom like '" . $search_column1 . "'
                                AND value like '" . $distrik->code1 . "'
                                AND row in (
                                    SELECT row
                                    FROM pgdl_excel_datas_revisi e
                                    JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                                    WHERE pgdl_file_import_revisi_id in " . $form_id . "
                                    AND s.name like '" . $sheet_name_form . "'
                                    AND e.lokasi_id = " . $lokasi_id . "
                                    AND kolom like '" . $search_column2 . "'
                                    AND value like (
                                        SELECT value FROM pgdl_excel_datas_revisi e
                                        JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                                        WHERE pgdl_file_import_revisi_id in " . $pgdl_file_import_revisi_id . "
                                        AND s.name like '" . $sheet_name_rkau . "'
                                        AND e.lokasi_id = " . $lokasi_id . "
                                        AND kolom like '" . $search_cell_column_2 . "'
                                        AND row = " . $search_cell_row_2 . "
                                    )
                                )
                            )");
        // change request september 2020 baris 905

        $value = !empty($data) ? $data[0]->value : 0;
        return $value;
    }

    function get_rkap_sd_bulan_bahan_bakar_non_luar_jawa($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name_form, $start_kolom, $search_column1, $search_column2, $search_column3, $search_column4, $distrik, $lokasi_id)
    {
        // dd($lokasi_id);
        $array_bulan = $this->get_bulan_array_non_luar_jawa($bulan);
        $array_lokasi = $this->get_location_array_non_luar_jawa($distrik->id, 'name', $lokasi_id);
        $form_id = $this->get_file_import_revisi_non_luar_jawa($pgdl_file_import_revisi_id, 'form_bahan_bakar_pgdl_file_import_revisi_id');

        if ($form_id == NULL)
            return 0;

        $data = DB::select("
            SELECT sum(value::float) AS value
            FROM pgdl_excel_datas_revisi e
            JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
            WHERE pgdl_file_import_revisi_id in " . $form_id . "
            AND s.name like '" . $sheet_name_form . "'
            AND e.lokasi_id = " . $lokasi_id . "
            AND kolom like '" . $start_kolom . "'
            AND row in (
                SELECT row FROM pgdl_excel_datas_revisi e
                JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                WHERE pgdl_file_import_revisi_id in " . $form_id . "
                AND s.name like '" . $sheet_name_form . "'
                AND e.lokasi_id = " . $lokasi_id . "
                AND kolom like '" . $search_column1 . "'
                AND value like '" . $distrik->code1 . "'

                AND row in (
                    SELECT row FROM pgdl_excel_datas_revisi e
                    JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                    WHERE pgdl_file_import_revisi_id in " . $form_id . "
                    AND s.name like '" . $sheet_name_form . "'
                    AND e.lokasi_id = " . $lokasi_id . "
                    AND kolom like '" . $search_column2 . "'
                    AND value in " . $array_lokasi . "

                AND row in (
                    SELECT row FROM pgdl_excel_datas_revisi e
                    JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                    WHERE pgdl_file_import_revisi_id in " . $form_id . "
                    AND s.name like '" . $sheet_name_form . "'
                    AND e.lokasi_id = " . $lokasi_id . "
                    AND kolom like '" . $search_column3 . "'
                    AND value like '" . $tahun . "'
                    AND row in (
                        SELECT row FROM pgdl_excel_datas_revisi e
                        JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                        WHERE pgdl_file_import_revisi_id in " . $form_id . "
                        AND s.name like '" . $sheet_name_form . "'
                        AND e.lokasi_id = " . $lokasi_id . "
                        AND kolom like '" . $search_column4 . "'
                        AND value in " . $array_bulan . "
                    )
                )
            )
        )");
        $value = !empty($data) ? ($data[0]->value != null ? $data[0]->value : 0) : 0;
        return $value;
    }

    function get_rkap_sd_bulan_per_bahan_bakar_non_luar_jawa($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name_form, $start_kolom, $search_column1, $search_column2, $search_column3, $search_column4, $search_column5, $distrik, $jenis_bahan_bakar, $lokasi_id)
    {
        $array_bulan = $this->get_bulan_array_non_luar_jawa($bulan);
        $array_lokasi = $this->get_location_array_non_luar_jawa($distrik->id, 'name', $lokasi_id);
        $form_id = $this->get_file_import_revisi_non_luar_jawa($pgdl_file_import_revisi_id, 'form_bahan_bakar_pgdl_file_import_revisi_id');

        if ($form_id == NULL)
            return 0;

        $data = DB::select("SELECT COALESCE(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) AS value
            FROM pgdl_excel_datas_revisi e
            JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
            WHERE pgdl_file_import_revisi_id in " . $form_id . "
            AND s.name like '" . $sheet_name_form . "'
            AND e.lokasi_id = " . $lokasi_id . "
            AND kolom like '" . $start_kolom . "'
            AND row in (
                SELECT row
                FROM pgdl_excel_datas_revisi e
                JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                WHERE pgdl_file_import_revisi_id in " . $form_id . "
                AND s.name like '" . $sheet_name_form . "'
                AND e.lokasi_id = " . $lokasi_id . "
                AND kolom like '" . $search_column1 . "'
                AND value like '" . $distrik->code1 . "'
                AND row in (
                    SELECT row
                    FROM pgdl_excel_datas_revisi e
                    JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                    WHERE pgdl_file_import_revisi_id in " . $form_id . "
                    AND s.name like '" . $sheet_name_form . "'
                    AND e.lokasi_id = " . $lokasi_id . "
                    AND kolom like '" . $search_column2 . "'
                    AND value in " . $array_lokasi . "
                    AND row in (
                        SELECT row
                        FROM pgdl_excel_datas_revisi e
                        JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                        WHERE pgdl_file_import_revisi_id in " . $form_id . "
                        AND s.name like '" . $sheet_name_form . "'
                        AND e.lokasi_id = " . $lokasi_id . "
                        AND kolom like '" . $search_column3 . "'
                        AND value like '" . $jenis_bahan_bakar . "'
                        AND row in (
                            SELECT row
                            FROM pgdl_excel_datas_revisi e
                            JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                            WHERE pgdl_file_import_revisi_id in " . $form_id . "
                            AND s.name like '" . $sheet_name_form . "'
                            AND e.lokasi_id = " . $lokasi_id . "
                            AND kolom like '" . $search_column4 . "'
                            AND value like '" . $tahun . "'
                            AND row in (
                                SELECT row
                                FROM pgdl_excel_datas_revisi e
                                JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                                WHERE pgdl_file_import_revisi_id in " . $form_id . "
                                AND s.name like '" . $sheet_name_form . "'
                                AND e.lokasi_id = " . $lokasi_id . "
                                AND kolom like '" . $search_column5 . "'
                                AND value in " . $array_bulan . ")
                        )
                    )
                )
            )");

        $value = !empty($data) ? $data[0]->value : 0;
        return $value;
    }

    function get_realisasi_produksi_penjualan_non_luar_jawa($tahun, $bulan, $distrik, $produksi_penjualan_id, $lokasi_id)
    {
        // $realisasi = PgdlRealisasiProduksiPenjualan::where('tahun_realisasi', $tahun)->where('bulan_realisasi', $bulan)->whereIn('lokasi_id', $locations)->where('produksi_penjualan_id', $produksi_penjualan_id)->get();
        $realisasi = DB::select("select realisasi from pgdl_realisasi_produksi_penjualan
        where lokasi_id = " . $lokasi_id . "
        and tahun_realisasi = " . $tahun . "
        and bulan_realisasi <= " . $bulan . "
        and produksi_penjualan_id = " . $produksi_penjualan_id);
        // dd($realisasi);
        $realisasi = !empty($realisasi) ? $realisasi[0]->realisasi : 0;
        return $realisasi;
    }

    function get_bulan_array_non_luar_jawa($bulan)
    {
        $array_bulan = array();
        for ($i = 1; $i <= $bulan; $i++) {
            $array_bulan[$i] = "'" . $i . "'";
        }
        $array_bulan = implode(',', $array_bulan);
        $array_bulan = "(" . $array_bulan . ")";
        return $array_bulan;
    }

    function get_column_array_non_luar_jawa($start_kolom, $bulan, $increment)
    {
        $columns = array();
        for ($i = 1; $i <= $bulan; $i++) {
            $columns[$i] = "'" . $start_kolom . "'";
            // untuk menentukan kolom bulan sesuai increment. harus penambahan manual karena start_kolom adalah string
            // jika langsung ditambahkan sesuai increment, akan berubah menjadi angka
            for ($incr = 1; $incr <= $increment; $incr++)
                $start_kolom++;
        }
        $columns = implode(',', $columns);
        $columns = "(" . $columns . ")";
        return $columns;
    }

    function get_location_array_non_luar_jawa($distrik_id, $column, $lokasi_id)
    {
        $locations = array();
        // dump($distrik_id, $column, $lokasi_id);
        $loc = Lokasi::where('id', $lokasi_id)->get();
        // dd($distrik_id, $column, $lokasi_id, $loc);
        foreach ($loc as $key => $value) {
            if ($column == 'name')
                $locations[$key] = "'" . $value[$column] . "'";
            else
                $locations[$key] = $value[$column];
        }
        $locations = implode(',', $locations);
        $locations = "(" . $locations . ")";

        return $locations;
    }

    function get_file_import_revisi_non_luar_jawa($pgdl_file_import_revisi_id, $form_name)
    {
        $file_import_revisi = DB::select("select * from pgdl_file_imports_revisi where id IN " . $pgdl_file_import_revisi_id . " and " . $form_name . " IS NOT NULL and " . $form_name . " <> 0 ");
        // PGDLFileImportRevisi::whereIn('id', $pgdl_file_import_revisi_id)->get();

        if ($file_import_revisi) {
            $res = [];
            $i = 0;
            foreach ($file_import_revisi as $key => $value) {
                $res[$key] = $value->$form_name;
                $i++;
            }
            $res = implode(",", $res);
            $res = "(" . $res . ")";
            return $res;
        }
        return NULL;
    }

    function get_keterangan_number_indentation_non_luar_jawa($i, $no_utama, $no_sub_1, $no_sub_2, $no_sub_3)
    {
        // untuk menampilkan indentasi atau tidak
        $row_utama = [14, 26, 50, 52, 58, 61, 62, 63, 65];
        $row_sub_1 = [15, 21, 24, 28, 38, 45, 46, 47, 48, 53, 54, 55, 56, 57, 59, 60, 66, 67, 68, 69];
        $row_sub_2 = [16, 17, 18, 19, 20, 22, 23, 29, 30, 31, 32, 33, 34, 35, 36, 37, 39, 42];
        $text_result = '';

        // khusus baris 14, nomor dimulai dari 2 ;
        $no_utama = ($i == 14 ? $no_utama = 1 : ($i == 65 ? $no_utama = 0 : $no_utama));

        // khusus baris 22 & 23, nomor +1;
        $no_sub_1 = ($i == 23 ? 1 : ($i == 24 ? 2 : $no_sub_1));

        if (in_array($i, $row_utama, true)) {
            //tanpa indentasi
            $text_result = ++$no_utama . ". ";
            $no_sub_1 = $no_sub_2 = $no_sub_3 = 0;
        } elseif (in_array($i, $row_sub_1, true)) {
            //sub 1, indentasi
            $no_sub_2 = $no_sub_3 = 0;
            $text_result = "&nbsp;&nbsp;&nbsp;&nbsp;" . $no_utama . "." . ++$no_sub_1 . " ";
        } elseif (in_array($i, $row_sub_2, true)) {
            //sub 2, indentasi
            $no_sub_3 = 0;

            $text_result = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" . $no_utama . "." . $no_sub_1 . "." . ++$no_sub_2 . " ";
        } else {
            $text_result = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" . $no_utama . "." . $no_sub_1 . "." . $no_sub_2 . "." . ++$no_sub_3 . " ";
        }
        $result = array(
            'number_indentation' => $text_result,
            'no_utama' => $no_utama,
            'no_sub_1' => $no_sub_1,
            'no_sub_2' => $no_sub_2,
            'no_sub_3' => $no_sub_3
        );

        return $result;
    }

    function get_file_id_pengendalian($jenis_id, $tahun_anggaran, $distrik_id)
    {
        $files = DB::select("select p.id
                        from pgdl_file_imports_revisi p
                        join pgdl_templates t on t.id = p.pgdl_template_id
                        where t.jenis_id = " . $jenis_id . "
                        and p.tahun=" . $tahun_anggaran . "
                        and p.distrik_id = " . $distrik_id . ";");

        if ($files) {
            $res = [];
            $i = 0;
            foreach ($files as $key => $value) {
                $res[$i] = $value->id;
                $i++;
            }
            $res = implode(",", $res);
            //dd(var_dump($new));
            $res = "(" . $res . ")";
            return $res;
        }
        return $files;
    }

    function get_data_pengendalian($file_id, $sheet_name, $kolom)
    {
        $datas = DB::select("select e.row, e.value
                            from pgdl_excel_datas_revisi e
                            join pgdl_sheets s on s.id = e.pgdl_sheet_id
                            where s.name = '" . $sheet_name . "'
                            and e.pgdl_file_import_revisi_id in " . $file_id . "
                            and e.kolom = '" . $kolom . "'
                            and e.row > 12
                            order by e.row;");
        if ($datas) {
            $results = [];
            foreach ($datas as $key => $value) {
                $results[$value->row] = $value->value;
            }
            return $results;
        }
        return $datas;
    }

    function get_parent_code($keterangan, $strategi_bisnis)
    {
        if ($strategi_bisnis->name == 'OM') {
            $data = PgdlLRParentCode::where('keterangan', 'like', "%" . $keterangan . "%")
                ->whereNotIn('kode_parent_om', ['#', '-'])
                ->first();
            // dump($data);
            $parent_code = !empty($data) ? $data->kode_parent_om : '';
        } else {
            $data = PgdlLRParentCode::where('keterangan', 'like', "%" . $keterangan . "%")
                ->whereNotIn('kode_parent_up', ['#', '-'])
                ->first();

            $parent_code = !empty($data) ? $data->kode_parent_up : '';
        }
        // dump($data);
        // dump($parent_code);
        return $parent_code;
    }

    // function get_realisasi($parent, $distrik, $year, $month){

    //     $data = PgdlPljPrkAo::
    //             selectRaw('dstrct_code, sum(tran_amount) as value')
    //             ->where('dstrct_code', $distrik->code1)
    //             ->where('years', $year)
    //             ->where('months','<=',$month)
    //             ->where('project_no', 'ilike', "%".$parent."%")
    //             ->groupBy('dstrct_code')
    //             ->first();

    //     $value = !empty($data) ? $data->value : 0;
    //     return $value;
    // }

    function get_rkap_sd_bulan($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name, $start_kolom, $row)
    {
        $columns = $this->get_column_array($start_kolom, $bulan, 1);

        $data = DB::select("select e.row, coalesce(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) as value
                from pgdl_excel_datas_revisi e
                join pgdl_sheets s on e.pgdl_sheet_id = s.id
                where e.pgdl_file_import_revisi_id in " . $pgdl_file_import_revisi_id . "
                and e.row = " . $row . "
                and e.kolom in " . $columns . "
                and s.name like '" . $sheet_name . "'
                group by e.row
                order by e.row;");

        $value = !empty($data) ? $data[0]->value : 0;
        return $value;
    }

    function get_rkap_sd_bulan_biaya_usaha_lainnya($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name, $start_kolom, $search_column, $search_cell_column, $search_cell_row)
    {
        $columns = $this->get_column_array($start_kolom, $bulan, 1);

        $data = DB::select("select COALESCE(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) as value
                from pgdl_excel_datas_revisi e
                join pgdl_sheets s on e.pgdl_sheet_id = s.id
                where pgdl_file_import_revisi_id IN " . $pgdl_file_import_revisi_id . "
                and s.name = '" . $sheet_name . "'
                and kolom in " . $columns . "
                and row in (
                    select row
                    from pgdl_excel_datas_revisi e
                    join pgdl_sheets s on e.pgdl_sheet_id = s.id
                    where pgdl_file_import_revisi_id IN " . $pgdl_file_import_revisi_id . "
                    and s.name = '" . $sheet_name . "'
                    and kolom like '" . $search_column . "'
                    and value in (
                        select value
                        from pgdl_excel_datas_revisi e
                        join pgdl_sheets s on e.pgdl_sheet_id = s.id
                        where pgdl_file_import_revisi_id IN " . $pgdl_file_import_revisi_id . "
                        and s.name = '" . $sheet_name . "'
                        and kolom like '" . $search_cell_column . "'
                        and row = " . $search_cell_row . "
                    )
                )");
        $value = !empty($data) ? $data[0]->value : 0;
        return $value;
    }

    function get_rkap_sd_bulan_form_6_10($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name_rkau, $sheet_name_form, $start_kolom, $search_column1, $search_cell_column_1, $search_cell_row_1, $search_column2, $search_cell_column_2, $search_cell_row_2, $jenis_id, $distrik)
    {

        $columns = $this->get_column_array($start_kolom, $bulan, 2);
        if ($jenis_id == 2)
            $form_id = $this->get_file_import_revisi($pgdl_file_import_revisi_id, 'form6_rutin_pgdl_file_import_revisi_id');
        elseif ($jenis_id == 3)
            $form_id = $this->get_file_import_revisi($pgdl_file_import_revisi_id, 'form6_reimburse_pgdl_file_import_revisi_id');
        // elseif($jenis_id == 6)
        else
            $form_id = $this->get_file_import_revisi($pgdl_file_import_revisi_id, 'form10_pln_pgdl_file_import_revisi_id');

        if ($form_id == NULL)
            return 0;

        $data = DB::select("SELECT COALESCE(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) AS value
                            FROM pgdl_excel_datas_revisi e
                            JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                            WHERE pgdl_file_import_revisi_id in " . $form_id . "
                            AND s.name like '" . $sheet_name_form . "'
                            AND kolom in " . $columns . "
                            AND row in (
                                SELECT row
                                FROM pgdl_excel_datas_revisi e
                                JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                                WHERE pgdl_file_import_revisi_id in " . $form_id . "
                                AND s.name like '" . $sheet_name_form . "'
                                AND kolom like '" . $search_column1 . "'
                                AND value like '" . $distrik->code1 . "'
                                AND row in (
                                    SELECT row
                                    FROM pgdl_excel_datas_revisi e
                                    JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                                    WHERE pgdl_file_import_revisi_id in " . $form_id . "
                                    AND s.name like '" . $sheet_name_form . "'
                                    AND kolom like '" . $search_column2 . "'
                                    AND value like (
                                        SELECT value FROM pgdl_excel_datas_revisi e
                                        WHERE pgdl_file_import_revisi_id in " . $pgdl_file_import_revisi_id . "
                                        AND s.name like '" . $sheet_name_rkau . "'
                                        AND kolom like '" . $search_cell_column_2 . "'
                                        AND row = " . $search_cell_row_2 . "
                                    )
                                )
                            )");

        $value = !empty($data) ? $data[0]->value : 0;
        return $value;
    }

    function get_rkap_sd_bulan_bahan_bakar($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name_form, $start_kolom, $search_column1, $search_column2, $search_column3, $search_column4, $distrik)
    {
        $array_bulan = $this->get_bulan_array($bulan);
        $array_lokasi = $this->get_location_array($distrik->id, 'name');
        $form_id = $this->get_file_import_revisi($pgdl_file_import_revisi_id, 'form_bahan_bakar_pgdl_file_import_revisi_id');

        if ($form_id == NULL)
            return 0;

        $data = DB::select("
            SELECT sum(value::float) AS value
            FROM pgdl_excel_datas_revisi e
            JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
            WHERE pgdl_file_import_revisi_id in " . $form_id . "
            AND s.name like '" . $sheet_name_form . "'
            AND kolom like '" . $start_kolom . "'
            AND row in (
                SELECT row FROM pgdl_excel_datas_revisi e
                JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                WHERE pgdl_file_import_revisi_id in " . $form_id . "
                AND s.name like '" . $sheet_name_form . "'
                AND kolom like '" . $search_column1 . "'
                AND value like '" . $distrik->code1 . "'

                AND row in (
                    SELECT row FROM pgdl_excel_datas_revisi e
                    JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                    WHERE pgdl_file_import_revisi_id in " . $form_id . "
                    AND s.name like '" . $sheet_name_form . "'
                    AND kolom like '" . $search_column2 . "'
                    AND value in " . $array_lokasi . "

                AND row in (
                    SELECT row FROM pgdl_excel_datas_revisi e
                    JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id WHERE pgdl_file_import_revisi_id in " . $form_id . "
                    AND s.name like '" . $sheet_name_form . "'
                    AND kolom like '" . $search_column3 . "'
                    AND value like '" . $tahun . "'
                    AND row in (
                        SELECT row FROM pgdl_excel_datas_revisi e
                        JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                        WHERE pgdl_file_import_revisi_id in " . $form_id . "
                        AND s.name like '" . $sheet_name_form . "'
                        AND kolom like '" . $search_column4 . "'
                        AND value in " . $array_bulan . "
                    )
                )
            )
        )");
        $value = !empty($data) ? ($data[0]->value != null ? $data[0]->value : 0) : 0;
        return $value;
    }

    function get_rkap_sd_bulan_per_bahan_bakar($pgdl_file_import_revisi_id, $tahun, $bulan, $sheet_name_form, $start_kolom, $search_column1, $search_column2, $search_column3, $search_column4, $search_column5, $distrik, $jenis_bahan_bakar)
    {
        $array_bulan = $this->get_bulan_array($bulan);
        $array_lokasi = $this->get_location_array($distrik->id, 'name');
        $form_id = $this->get_file_import_revisi($pgdl_file_import_revisi_id, 'form_bahan_bakar_pgdl_file_import_revisi_id');

        if ($form_id == NULL)
            return 0;

        $data = DB::select("SELECT COALESCE(sum(CASE WHEN value <> '' THEN value::float ELSE 0 END),0) AS value
            FROM pgdl_excel_datas_revisi e
            JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
            WHERE pgdl_file_import_revisi_id in " . $form_id . "
            AND s.name like '" . $sheet_name_form . "'
            AND kolom like '" . $start_kolom . "'
            AND row in (
                SELECT row
                FROM pgdl_excel_datas_revisi e
                JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                WHERE pgdl_file_import_revisi_id in " . $form_id . "
                AND s.name like '" . $sheet_name_form . "'
                AND kolom like '" . $search_column1 . "'
                AND value like '" . $distrik->code1 . "'
                AND row in (
                    SELECT row
                    FROM pgdl_excel_datas_revisi e
                    JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                    WHERE pgdl_file_import_revisi_id in " . $form_id . "
                    AND s.name like '" . $sheet_name_form . "'
                    AND kolom like '" . $search_column2 . "'
                    AND value in " . $array_lokasi . "
                    AND row in (
                        SELECT row
                        FROM pgdl_excel_datas_revisi e
                        JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                        WHERE pgdl_file_import_revisi_id in " . $form_id . "
                        AND s.name like '" . $sheet_name_form . "'
                        AND kolom like '" . $search_column3 . "'
                        AND value like '" . $jenis_bahan_bakar . "'
                        AND row in (
                            SELECT row
                            FROM pgdl_excel_datas_revisi e
                            JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                            WHERE pgdl_file_import_revisi_id in " . $form_id . "
                            AND s.name like '" . $sheet_name_form . "'
                            AND kolom like '" . $search_column4 . "'
                            AND value like '" . $tahun . "'
                            AND row in (
                                SELECT row
                                FROM pgdl_excel_datas_revisi e
                                JOIN pgdl_sheets s on s.id = e.pgdl_sheet_id
                                WHERE pgdl_file_import_revisi_id in " . $form_id . "
                                AND s.name like '" . $sheet_name_form . "'
                                AND kolom like '" . $search_column5 . "'
                                AND value in " . $array_bulan . ")
                        )
                    )
                )
            )");

        $value = !empty($data) ? $data[0]->value : 0;
        return $value;
    }

    function get_realisasi_produksi_penjualan($tahun, $bulan, $distrik, $produksi_penjualan_id)
    {
        $locations = $this->get_location_array($distrik->id, 'id');
        // $realisasi = PgdlRealisasiProduksiPenjualan::where('tahun_realisasi', $tahun)->where('bulan_realisasi', $bulan)->whereIn('lokasi_id', $locations)->where('produksi_penjualan_id', $produksi_penjualan_id)->get();
        $realisasi = DB::select("select realisasi from pgdl_realisasi_produksi_penjualan where lokasi_id IN " . $locations . " and tahun_realisasi = " . $tahun . " and bulan_realisasi = " . $bulan . " and produksi_penjualan_id = " . $produksi_penjualan_id);

        $realisasi = !empty($realisasi) ? $realisasi[0]->realisasi : 0;
        return $realisasi;
    }

    function get_bulan_array($bulan)
    {
        $array_bulan = array();
        for ($i = 1; $i <= $bulan; $i++) {
            $array_bulan[$i] = "'" . $i . "'";
        }
        $array_bulan = implode(',', $array_bulan);
        $array_bulan = "(" . $array_bulan . ")";
        return $array_bulan;
    }

    function get_column_array($start_kolom, $bulan, $increment)
    {
        $columns = array();
        for ($i = 1; $i <= $bulan; $i++) {
            $columns[$i] = "'" . $start_kolom . "'";
            // untuk menentukan kolom bulan sesuai increment. harus penambahan manual karena start_kolom adalah string
            // jika langsung ditambahkan sesuai increment, akan berubah menjadi angka
            for ($incr = 1; $incr <= $increment; $incr++)
                $start_kolom++;
        }
        $columns = implode(',', $columns);
        $columns = "(" . $columns . ")";
        return $columns;
    }

    function get_location_array($distrik_id, $column)
    {
        $locations = array();
        $loc = Lokasi::where('distrik_id', $distrik_id)->get();
        foreach ($loc as $key => $value) {
            if ($column == 'name')
                $locations[$key] = "'" . $value[$column] . "'";
            else
                $locations[$key] = $value[$column];
        }
        $locations = implode(',', $locations);
        $locations = "(" . $locations . ")";

        return $locations;
    }

    function get_file_import_revisi($pgdl_file_import_revisi_id, $form_name)
    {
        $file_import_revisi = DB::select("select * from pgdl_file_imports_revisi where id IN " . $pgdl_file_import_revisi_id . " and " . $form_name . " IS NOT NULL and " . $form_name . " <> 0 ");
        // PGDLFileImportRevisi::whereIn('id', $pgdl_file_import_revisi_id)->get();

        if ($file_import_revisi) {
            $res = [];
            $i = 0;
            foreach ($file_import_revisi as $key => $value) {
                $res[$key] = $value->$form_name;
                $i++;
            }
            $res = implode(",", $res);
            $res = "(" . $res . ")";
            return $res;
        }
        return NULL;
    }

    function get_keterangan_number_indentation($i, $no_utama, $no_sub_1, $no_sub_2, $no_sub_3)
    {
        // untuk menampilkan indentasi atau tidak
        $row_utama = [14, 26, 50, 52, 58, 61, 62, 63, 65];
        $row_sub_1 = [15, 21, 24, 28, 38, 45, 46, 47, 48, 53, 54, 55, 56, 57, 59, 60, 66, 67, 68, 69];
        $row_sub_2 = [16, 17, 18, 19, 20, 22, 23, 29, 30, 31, 32, 33, 34, 35, 36, 37, 39, 42];
        $text_result = '';

        // khusus baris 14, nomor dimulai dari 2 ;
        $no_utama = ($i == 14 ? $no_utama = 1 : ($i == 65 ? $no_utama = 0 : $no_utama));

        // khusus baris 22 & 23, nomor +1;
        $no_sub_1 = ($i == 23 ? 1 : ($i == 24 ? 2 : $no_sub_1));

        if (in_array($i, $row_utama, true)) {
            //tanpa indentasi
            $text_result = ++$no_utama . ". ";
            $no_sub_1 = $no_sub_2 = $no_sub_3 = 0;
        } elseif (in_array($i, $row_sub_1, true)) {
            //sub 1, indentasi
            $no_sub_2 = $no_sub_3 = 0;
            $text_result = "&nbsp;&nbsp;&nbsp;&nbsp;" . $no_utama . "." . ++$no_sub_1 . " ";
        } elseif (in_array($i, $row_sub_2, true)) {
            //sub 2, indentasi
            $no_sub_3 = 0;

            $text_result = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" . $no_utama . "." . $no_sub_1 . "." . ++$no_sub_2 . " ";
        } else {
            $text_result = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" . $no_utama . "." . $no_sub_1 . "." . $no_sub_2 . "." . ++$no_sub_3 . " ";
        }
        $result = array(
            'number_indentation' => $text_result,
            'no_utama' => $no_utama,
            'no_sub_1' => $no_sub_1,
            'no_sub_2' => $no_sub_2,
            'no_sub_3' => $no_sub_3
        );

        return $result;
    }
}
